{
    "event": true,
    "locked": true,
    "starred": true,
    "name": "event.fetchURL",
    "command": "const { document, window } = new (jsdom().JSDOM)('');\nconst anchor = document.createElement('a');\n\nfunction setDOM(url) {\n    const page = fetchSync(url, {\n        headers: {\n            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n            'Accept-Language': 'en-GB,en;q=0.5',\n            'Content-Language': 'en-GB,en;q=0.5',\n            'User-Agent': /youtu\\.?be|google|reddit/.test(url) ? '' : 'Googlebot',\n        },\n    });\n    document.open();\n    document.write(page);\n    document.close();\n};\n\nfunction domTitle() {\n    const metaTitle = document.head.querySelector('meta[name=\"title\"]');\n    return metaTitle ? metaTitle.content : document.title;\n}\n\nconst filterWords = /forbidden|not found|access denied|your browser|rick roll|never gonna give you up/i;\n\nfunction hasInfo(url, _title) {\n    const title = _title.replace(/\\s+/g, ' ').trim();\n    const isFresh = title.split(' ')\n        .filter(word => (\n            !(new RegExp(word.replace(/[^.a-zA-Z0-9\\u00c0-\\u017e]+/g, ''), 'i')).test(url)\n        )).length >= 1;\n    return isFresh && !filterWords.test(title);\n}\n\nIRC.listen('message', event => {\n    if (!IRC.queryConfig('fetchURL', true)) return;\n    const urls = event.message.text.match(/(\\b(https?):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;()]*[-A-Z0-9+&@#\\/%=~_|()])/ig);\n    if (!urls || event.message.text.includes('##')) return;\n\n    const [url] = urls;\n\n    fetch(url)\n        .then(res => {\n            log([1, 'log', res]);\n            return res.json();\n        })\n        .then((res) => {\n            log([2, 'log', res]);\n        })\n        .catch(d => {\n            log([3, 'error', d]);\n        })\n\n    return;\n\n    anchor.setAttribute('href', url);\n\n\n    if (customURL()) return;\n\n    // normal URL parsing\n\n    setDOM(url);\n    const title = domTitle();\n    if (title.length < 400 && (IRC.queryConfig('fetchURLAll', false) || hasInfo(url, title))) {\n        print.info(title);\n    }\n});\n\nfunction customURL() {\n    if (anchor.hostname.includes('github.')) {\n        if (anchor.pathname.split('/').length === 3) {\n            // it's a repo url\n            const {\n                description,\n                html_url,\n                stargazers_count,\n                language,\n                license, // { name }\n            } = fetchSync.json(`https://api.github.com/repos${anchor.pathname}`);\n            print(`{gr}Github#{/} ${description} ${IRC.colors.nick(language, false)} {y}â˜…{/} {bo}${stargazers_count}{/} {dgr}${license.name}{/}`);\n            return true;\n        }\n        // twitter\n        // youtube\n        // reddit\n    }\n}"
}