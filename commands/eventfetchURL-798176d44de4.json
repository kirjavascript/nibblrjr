{
    "event": true,
    "locked": true,
    "starred": true,
    "name": "event.fetchURL",
    "command": "const { document } = new (jsdom().JSDOM)('');\nconst bytes = IRC.require('bytes');\n\n// const filterWords = /forbidden|not found|access denied|your browser|rick roll|never gonna give you up/i;\n\nfunction domTitle(url) {\n    const page = fetchSync(url, {\n        headers: {\n            'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\n            'Accept-Language': 'en-GB,en;q=0.5',\n            'Content-Language': 'en-GB,en;q=0.5',\n            'User-Agent': /youtu\\.?be|google|reddit/.test(url) ? '' : 'Googlebot',\n        },\n    });\n    document.open();\n    document.write(page);\n    document.close();\n    return document.title;\n}\n\nIRC.listen('message', event => {\n    if (!IRC.queryConfig('fetchURL', true)) return;\n    const urls = event.message.text.match(/(\\b(https?):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;()]*[-A-Z0-9+&@#\\/%=~_|()])/ig);\n    if (!urls || event.message.text.includes('##')) return;\n    const showAll = IRC.queryConfig('fetchURLAll', false);\n    //log(urls)\n    urls.forEach(url => {\n        //const title = fetchSync.dom(url).document.querySelector('title').textContent;\n        //print.info(title)\n        //const [, metaTitle] = page.match(/<meta\\s+name=\"title\"\\s+content=\"(.+?)\"/i) || ['', ''];\n        //const [, tagTitle] = page.match(/<title[^>]*>([\\S\\s]+?)<\\/title>/i) || ['', ''];\n        //const baseTitle = metaTitle || tagTitle;\n        //print.info(baseTitle);\n        print.info(domTitle(url));\n\n                        // if (baseTitle) {\n                        //     const title = entities.decode(baseTitle).replace(/\\s+/g, ' ').trim();\n                        //     const isFresh = title.split(' ')\n                        //         .filter(word => (\n                        //             !(new RegExp(word.replace(/[^.a-zA-Z0-9\\u00c0-\\u017e]+/g, ''), 'i')).test(url[0])\n                        //         )).length >= 1;\n\n                        //     if (title.length < 400 &&\n                        //         (showAll || (isFresh && !filterWords.test(title)))\n                        //     ) {\n                        //         print.info(title);\n                        //     }\n                        // }\n    });\n    // meta headers\n\n    // entities / CJK\n    // config is not defined reddit only\n    // sync nature\n    // filesize timeout\n\n}, { showError: 1 });"
}