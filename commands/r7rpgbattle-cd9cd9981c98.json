{
    "locked": false,
    "starred": false,
    "name": "r7rpg.battle",
    "command": "const { from } = IRC.message\n\nlet player = store.load(from)\n\nif (! player.status) {\n  throw new Error('Use ~r7rpg.register to play') \n}\n\nif (player.status.type === 'dead') {\n  throw new Error(`{dc}${from}{/} cannot battle (Status: ${player.status.type})`)\n}\n\nif (player.status.type === 'idle' && player.quest && player.quest.name) {\n  throw new Error(`{dc}${from}{/} You cannot start a battle whilst in a quest`)\n}\n\nif (player.status.type === 'idle') {\n  if(IRC.command.params[0]) {\n    IRC.require('r7rpg.enemies').clonePlayer(IRC.command.params[0])\n    IRC.require('r7rpg.game').incrementInfo('enemies_battled')\n    player = store.load(from)\n  } else {\n    if (input === 'hardmode') {\n      const hardmode_level = (player.stats.level * 2) + (Math.floor(Math.random() * 5))\n      const hardmode_multiplier = 1 + Math.random()\n      IRC.require('r7rpg.enemies').newEnemy(null, hardmode_level, hardmode_multiplier)\n      IRC.require('r7rpg.game').incrementInfo('enemies_battled')\n      player = store.load(from)\n    } else {\n      IRC.require('r7rpg.enemies').newEnemy()\n      IRC.require('r7rpg.game').incrementInfo('enemies_battled')\n      player = store.load(from)\n    }\n  }\n}\n\nif (player.status.type != 'combat') {\n  throw new Error(`You cannot battle (Status: ${player.status.type})`)\n}\n\nif (player.status.type === 'combat') {\n  IRC.require('r7rpg.game').incrementInfo('player_attacks')\n  print(`{dc}${from}{/} ({p}lvl: ${player.stats.level}{/} | {r}hp: ${player.stats.current_health}/${player.stats.max_health}{/}) is battling a {g}${player.enemy.name}{/} ({p}lvl: ${player.enemy.level}{/} | {r}hp: ${player.enemy.health}{/})`)\n  const attack = IRC.require('r7rpg.player').getAttack()\n  IRC.require('r7rpg.player').damageEnemy(attack)\n}"
}