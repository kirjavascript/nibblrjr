{
    "locked": false,
    "starred": false,
    "name": "r7rpg.buy",
    "command": "const { from } = IRC.message\n\nlet player = store.load(from)\nlet shop = store.load('#shop')\n\nif (! player.status) {\n  throw new Error('Use ~r7rpg.register to play') \n}\n\nif (player.status.type === 'idle') {\n  let amount = IRC.command.params[0] ?? 1\n  let shopItem = IRC.require('r7rpg.shop').getShopItem()\n  let item, price, verbose\n  switch(String(input)) {\n    case 'Potion':\n    case 'Potions':\n      item = 'Potion'\n      price = 100 * amount\n      verbose = false\n      break\n    case 'Beans':\n      item = input\n      price = 1 * amount\n      verbose = false\n      break\n    case 'Item':\n    case 'Items':\n      item = \"Item\"\n      price = 1000 * amount\n      verbose = true\n      break\n    default:\n      if (String(input) === String(shopItem.name)) {\n        amount = 1\n        item = shopItem.name\n        price = shopItem.price\n        verbose = true\n        break\n      } else {\n      \tthrow new Error(`Use {y}~r7rpg.buy{/} item name. {y}~r7rpg.shop{/} to list items`)\n      }\n  }\n  if(amount && ! isNaN(amount) && amount > 0 && amount != 1) {\n    if (player.stats.money >= price) {\n      IRC.require('r7rpg.player').charge(price)\n      for (i = 0; i < amount; i++) {\n        if (item === \"Item\") {\n          IRC.require('r7rpg.player').giveItem(null, '{b}Shop{/}', null, verbose)\n        } else {\n          IRC.require('r7rpg.player').giveItem(item, '{b}Shop{/}', null, verbose)\n        }\n      }\n      if (item === 'Potion') {\n        IRC.require('r7rpg.game').incrementInfo('potions_bought', amount)\n      }\n      if (item === 'Item') {\n        IRC.require('r7rpg.game').incrementInfo('items_bought', amount)\n      }\n      print(`{dc}${from}{/} bought {p}${item}{y}*${amount}`)\n    } else {\n      throw new Error(`{y}${from}{/} is too poor to buy {p}${item}{y}*${amount}`)\n    }\n  } else {\n    if (player.stats.money >= price) {\n      IRC.require('r7rpg.player').charge(price)\n      if (item === 'Item') {\n        IRC.require('r7rpg.player').giveItem(null, '{b}Shop{/}')\n      } else {\n        IRC.require('r7rpg.player').giveItem(item, '{b}Shop{/}')\n      }\n      if (item === 'Potion') {\n        IRC.require('r7rpg.game').incrementInfo('potions_bought')\n      } else if (item === null || item === 'Beans') {\n        IRC.require('r7rpg.game').incrementInfo('items_bought')\n      } else {\n        IRC.require('r7rpg.game').incrementInfo('items_bought')\n        IRC.require('r7rpg.shop').newShopItem()\n      }\n    } else {\n      throw new Error(`{y}${from}{/} is too poor to buy {p}${item}{/}`)\n    }\n  }\n} else {\n  throw new Error(`{dc}${from}{/} cannot shop (Status: ${player.status.type})`)\n}"
}