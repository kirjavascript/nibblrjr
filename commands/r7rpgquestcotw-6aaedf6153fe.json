{
    "locked": false,
    "starred": false,
    "name": "r7rpg.quest_cotw",
    "command": "const { from } = IRC.message\nconst { getPlayer, savePlayer } = IRC.require('r7rpg.game')\nplayer = getPlayer()\n\nconst requirements = {\n  level: 8,\n  player: 'barf' //remove after beta\n}\n\nconst intro = `{dc}${from}{/}: Before you stands an old metal gate, a back entrance to an ancient castle. Will you enter the back door?`\n\nconst stage1Intro = `{dc}${from}{/}: The old gate is rusty, it opens without too much force. Old stone steps spiral downwards. Will you follow them down?`\n\nconst stage2Intro = `{dc}${from}{/}: You follow the stairs downwards..`\nconst stage2Intro2 = `{dc}${from}{/}: As you approach you see 5 black candles burning on the points of a pentagram drawn in blood. Your presence interupts {dr}3 faceless, hooded figures{/} chanting..`\nconst stage2Outro = `{dc}${from}{/}: You were too late..`\n\nconst stage3Intro = `{dc}${from}{/}: Lightning cracks down from the sky.. The ground starts rumbling and crumbles below the pentagram. A dark beast is rising..`\nconst stage3Outro = `{dc}${from}{/}: The beast is dead.. For now..`\n\nconst displayIntro = () => {\n  print(intro)\n  print(`{dc}${from}{/}: Use {y}~r7rpg.quest Crypt of the Wizard{/} to continue..`)\n}\n\nconst checkRequirements = (_player = player, verbose = false) => {\n  if (verbose) {\n    if (_player.stats.level < requirements.level) {\n      throw new Error(`{dc}${from}{/}: You must be level ${requirements.level} to attempt this quest`)\n    }\n    if (_player.completed_quests && _player.completed_quests.includes('Crypt of the Wizard')) {\n      throw new Error(`{dc}${from}{/}: You have already completed this quest`)\n    }\n  } else {\n    if (_player.stats.level >= requirements.level) {\n      if (! _player.completed_quests || ! _player.completed_quests.includes('Crypt of the Wizard')) {\n        if (_player = requirements.player){ //remove after beta\n          return true\n        } \n      }\n    }\n    return false\n  }\n}\n\nconst loadQuest = (silent) => {\n  player.quest.name = 'Crypt of the Wizard'\n  player.quest.command = 'r7rpg.quest_cotw'\n  player.quest.stage = 1\n  player.quest.attackCount = 0\n  player.quest.silent = silent\n  savePlayer(player)\n  stage1Start()\n}\n\nconst stage1Start = () => {\n  print(stage1Intro)\n  print(`{dc}${from}{/}: Use {y}~r7rpg.quest Yes{/} to continue..`)\n  print(`{dc}${from}{/}: Use {y}~r7rpg.quest No{/} to run away..`)\n}\n\nconst stage2Start = () => {\n  print(stage1Intro)\n  print(`{dc}${from}{/}: Use {y}~r7rpg.quest Yes{/} to continue..`)\n  print(`{dc}${from}{/}: Use {y}~r7rpg.quest No{/} to run away..`)\n}\n\nconst receiveCommand = (command) => {\n  switch (command) {\n    case 'Yes':\n      if (player.quest.stage === 1) {\n        stage2Start()\n        return true\n      }\n      break\n    case 'No':\n      if (player.quest.stage === 1) {\n        IRC.require('r7rpg.quest').resetQuest()\n        return true\n      }\n      break\n  }\n  return false\n}\n\nmodule.exports = {\n  displayIntro,\n  checkRequirements,\n  loadQuest,\n  receiveCommand\n}"
}