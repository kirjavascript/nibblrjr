{
    "locked": false,
    "starred": false,
    "name": "r7rpg.quest_df1",
    "command": "const { from } = IRC.message\nconst { getPlayer, savePlayer } = IRC.require('r7rpg.game')\nplayer = getPlayer()\n\nconst requirements = {\n  level: 5,\n}\n\nconst intro = `{dc}${from}{/}: You stand alone at the entrance to a {dr}Dark Forest{/}. The full moon lights a wooden signpost that reads \"Darkness lies ahead\".. Will you follow the left hand path?`\nconst stage1Intro = `{dc}${from}{/}: You enter the {dr}Dark Forest{/}.. You hear something rustling in the trees..`\nconst stage1Outro = `{dc}${from}{/}: The {dr}Evil Owl{/} flew away.. Could he have been a lookout bird?`\n\nconst stage2Intro = `{dc}${from}{/}: You continue down the left hand path. Ahead you see the light from a camp fire glistening through the trees..`\nconst stage2Intro2 = `{dc}${from}{/}: As you approach you see 5 black candles burning on the points of a pentagram drawn in blood. Your presence interupts {dr}3 faceless, hooded figures{/} chanting..`\nconst stage2Outro = `{dc}${from}{/}: You were too late..`\n\nconst stage3Intro = `{dc}${from}{/}: Lightning cracks down from the sky.. The ground starts rumbling and crumbles below the pentagram. A dark beast is rising..`\nconst stage3Outro = `{dc}${from}{/}: The beast is dead.. For now..`\n\nconst displayIntro = () => {\n  print(intro)\n  print(`{dc}${from}{/}: Use {y}~r7rpg.quest Dark Forest{/} to continue..`)\n}\n\nconst checkRequirements = (_player = player, verbose = false) => {\n  if (verbose) {\n    if (_player.stats.level < requirements.level) {\n      throw new Error(`{dc}${from}{/}: You must be level ${requirements.level} to attempt this quest`)\n    }\n    if (_player.completed_quests && _player.completed_quests.includes('Dark Forest')) {\n      throw new Error(`{dc}${from}{/}: You have already completed this quest`)\n    }\n  } else {\n    if (_player.stats.level >= requirements.level) {\n      if (! _player.completed_quests || ! _player.completed_quests.includes('Dark Forest')) {\n        return true  \n      }\n    }\n    return false\n  }\n}\n\nconst loadQuest = (silent) => {\n  player.quest.name = 'Dark Forest'\n  player.quest.command = 'r7rpg.quest_df1'\n  player.quest.stage = 1\n  player.quest.attackCount = 0\n  player.quest.silent = silent\n  savePlayer(player)\n  stage1Start()\n}\n\nconst stage1Start = () => {\n  if (! player.quest.silent) {\n    print(stage1Intro)\n    sleep(2000)\n  }\n  IRC.require('r7rpg.enemies').newEnemy(\"Evil Owl\", player.stats.level, 1)\n}\n\nconst stage1End = () => {\n  if (! player.quest.silent) {\n    print(stage1Outro)\n    sleep(2000)\n  }\n  stage2Start()\n}\n\nconst stage2Start = () => {\n  player.quest.stage++\n  if (! player.quest.silent) {\n    print(stage2Intro)\n    sleep(2000)\n    print(stage2Intro2)\n    sleep(2000)\n  }\n  player.quest.silenceKills = true\n  savePlayer(player)\n  IRC.require('r7rpg.enemies').newEnemy(\"3 Hooded Figures\", player.stats.level + 1, 0.7)\n}\n\nconst stage2End = () => {\n  if (! player.quest.silent) {\n    print(stage2Outro)\n    sleep(2000)\n  }\n  stage3Start()\n}\n\nconst stage3Start = () => {\n  player.quest.stage++\n  savePlayer(player)\n  if (! player.quest.silent) {\n    print(stage3Intro)\n    sleep(4000)\n  }\n  IRC.require('r7rpg.enemies').newEnemy(\"Monqui's Cat: Satan\", player.stats.level + 7, 1.1)\n}\n\nconst stage3End = () => {\n  print(stage3Outro)\n  print(`{dc}${from}{/} has completed {bl,dr} Dark Forest {/}`)\n  IRC.require('r7rpg.player').giveItem('Cursed Dice', '{o}Quest{/}')\n  IRC.require('r7rpg.player').giveItem('Dark Forest Medal', '{o}Quest{/}')\n  IRC.require('r7rpg.player').giveItem()\n  IRC.require('r7rpg.player').giveItem()\n  IRC.require('r7rpg.player').giveItem()\n  IRC.require('r7rpg.player').addXp(1000, true)\n  IRC.require('r7rpg.game').incrementInfo('quest_dark_forest_completed')\n  IRC.require('r7rpg.quest').completeQuest()\n}\n\nconst onPlayerAttack = () => {\n  player.quest.attackCount++\n  savePlayer(player)\n  \n  switch (player.enemy.name) {\n    case \"Evil Owl\":\n      print('*Hoot*')\n      break\n    default:\n      break\n  }\n}\n\nconst onEnemyAttack = () => {\n  switch (player.enemy.name) {\n    case \"Evil Owl\":\n      if (player.quest.attackCount > 1) {\n        IRC.require('r7rpg.player').reset()\n        stage1End()\n      } else {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n      break\n    case \"3 Hooded Figures\":\n      IRC.require('r7rpg.player').enemyAttack()\n      if (IRC.require('r7rpg.player').isAlive()) {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n\t  if (IRC.require('r7rpg.player').isAlive()) {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n      break\n    case \"2 Hooded Figures\":\n      IRC.require('r7rpg.player').enemyAttack()\n      if (IRC.require('r7rpg.player').isAlive()) {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n      break\n    case \"Hooded Figure\":\n      IRC.require('r7rpg.player').enemyAttack()\n      break\n    case \"Monqui's Cat: Satan\":\n      IRC.require('r7rpg.player').enemyAttack()\n      break\n    default:\n      break\n  }\n}\n\nconst onEnemyDead = () => {\n  switch (player.enemy.name) {\n    case \"Evil Owl\":\n      if (! player.quest.silent) {\n      \tprint(`{dc}${from}{/}: The {dr}Evil Owl{/} has ressurected..`)\n      }\n      IRC.require('r7rpg.player').reset()\n      stage1End()\n      break\n    case \"3 Hooded Figures\":\n      print(`{dc}${from}{/} killed one of the enemy {g}${player.enemy.name}{/} ({p}+${player.enemy.xp}xp {y}+$${player.enemy.money}{/})`)\n      IRC.require('r7rpg.enemies').newEnemy(\"2 Hooded Figures\", player.stats.level + 1, 0.5, false)\n      if (IRC.require('r7rpg.player').isAlive()) {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n      if (IRC.require('r7rpg.player').isAlive()) {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n      break\n    case \"2 Hooded Figures\":\n      print(`{dc}${from}{/} killed one of the enemy {g}${player.enemy.name}{/} ({p}+${player.enemy.xp}xp {y}+$${player.enemy.money}{/})`)\n      player.quest.silenceKills = false\n      savePlayer(player)\n      IRC.require('r7rpg.enemies').newEnemy(\"Hooded Figure\", player.stats.level + 1, 0.4, false)\n      if (IRC.require('r7rpg.player').isAlive()) {\n        IRC.require('r7rpg.player').enemyAttack()\n      }\n      break\n    case \"Hooded Figure\":\n      if (! player.quest.silent) {\n      \tprint(`{dc}${from}{/}: As the last {dr}Hooded Figure{/} dies, he begins chanting again..`)\n      }\n      IRC.require('r7rpg.player').reset()\n      stage2End()\n      break\n    case \"Monqui's Cat: Satan\":\n      stage3End()\n      break\n    default:\n      break\n  }\n}\n\nconst onPlayerDead = () => {\n  print(`{dc}${from}{/}: You have failed your quest`)\n  IRC.require('r7rpg.quest').resetQuest()\n}\n\nconst onUseItem = (item) => {\n  return true\n}\n\nconst receiveCommand = (command) => {\n  return false\n}\n\nmodule.exports = {\n  displayIntro,\n  checkRequirements,\n  loadQuest,\n  onPlayerAttack,\n  onEnemyAttack,\n  onEnemyDead,\n  onPlayerDead,\n  onUseItem,\n  receiveCommand\n}"
}