{
    "locked": false,
    "starred": false,
    "name": "r7rpg.shop",
    "command": "const { from } = IRC.message\n\nlet player = store.load(from)\n\nlet shop = store.load('#shop')\n\nlet isPast = require('date-fns/isPast')\nlet formatDistance = require('date-fns/formatDistance')\nlet format = require('date-fns/format')\n\nconst saveShop = () => {\n  store.save('#shop', shop)\n}\n\nconst newShopItem = () => {\n  input = null\n  shop.item = IRC.require('r7rpg.items').returnItem()\n  saveShop()\n  return shop.item\n}\n\nconst getShopItem = () => {\n  if (shop.item != undefined) {\n    const expires = new Date(shop.item.expires)\n    if (isPast(expires)) {\n      return newShopItem()\n    } else {\n      return shop.item\n    }\n  } else {\n    return newShopItem()\n  }\n}\n\nif (IRC.require('r7rpg.quest').inQuest()) {\n  throw new Error(`{dc}${from}{/} cannot shop. There are no shops here.`)\n}\n\nif (IRC.require('r7rpg.dungeon').inDungeon()) {\n  throw new Error(`{dc}${from}{/} cannot shop. There are no shops here.`)\n}\n\nif (input === 'list' || !module.required) {\n  input = null\n  print(`{dc}${from}{/} {y}$${player.stats.money}{/}`)\n  print(`{p}Beans{/}: {y}$1{/} {b}~r7rpg.buy Beans`)\n  print(`{p}Potion{/}: {y}$100{/} {b}~r7rpg.buy Potion`)\n  print(`{p}Item{/}: {y}$1000{/} {b}~r7rpg.buy Item`)\n\n  let shopItem = getShopItem()\n  const expires = new Date(shopItem.expires)\n  const distance = formatDistance(expires, new Date())\n  const time = format(expires, 'dd/MM/yyyy HH:mm')\n\n  print(`{p}${shopItem.name}{/} (${shopItem.pool}): {y}$${shopItem.price}{/} {b}~r7rpg.buy ${shopItem.name} {g}(Refreshes in ${distance} at ${time})`)\n}\n\nmodule.exports = {\n  getShopItem,\n  newShopItem\n}"
}