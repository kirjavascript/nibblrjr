{
    "name": "slots.mega",
    "command": "// disable in PM\n//if (IRC.message.isPM) {\n//    throw new Error('secret casinoing is verboten');\n//}\n\n// check score\nif ((store.get(IRC.message.from)||0) < 1500) {\n    throw new Error('you need at least {y}$1,500{/} to play megaslots')\n}\n\n// check delay\nconst lastSpin = store.get('lastspin$' + IRC.message.from);\nIRC.require('module.count').next();\nconst now = new Date();\nconst dateFns = require('date-fns@1.30.1');const { addMilliseconds, isBefore } = dateFns;\nif (lastSpin && isBefore(now, addMilliseconds(new Date(lastSpin), 1500))) {\n    throw new Error(IRC.message.from.toLowerCase() + ' pls wait 1.5s between spin');\n}\nstore.set('lastspin$' + IRC.message.from, now.toISOString());\n\nconst fruit = [\n    '{y,o} BELL ',\n    '{w,dr} CHERRY ',\n    '{w,dp} PLUM ',\n    '{w,dg} WEED ',\n    '{w,dr} STRAWBERRY ',\n    '{dgr,gr} COAL ',\n    '{p,dc} BLUEBERRY ',\n    '{w,o} ORANGE ',\n    '{r,dg} APPLE ',\n    '{y,bl} LEMON ',\n    '{dg,bl} LIME ',\n    '{w,o} WOOD ',\n    '{y,dr} FRIES ',\n    '{y,bl} BANANA ',\n    '{w,dp} PURPLE ',\n    '{g,dr} WATERMELON ',\n    '{w,gr} {rb}SKITTLES ',\n    '{w,dc} DIAMOND ',\n    '{y,dg} {bo}- 7 - ',\n    '{y,db} GOLD '\n].map(d => d + '{/}');\nconst bagSize = 15;\nconst wheelQty = 4;\nconst defaultJackpot = 1000;\nconst cost = 10;\nconst c = '$';\n\nconst bag = _.shuffle(fruit).splice(0, bagSize);\nconst roll = () => {\n    return bag[(Math.random())*bagSize|0];\n};\n\nconst wheels = Array.from({length: wheelQty}).map(roll);\n\nlet jackpot = store.get('$megapot');\nif (!jackpot) {\n    jackpot = defaultJackpot;\n    store.set('$megapot', defaultJackpot)\n}\nconst jackpotStr = Intl.NumberFormat().format(+jackpot);\nconst pad = wheels.map(d => d.replace(/{(.*?)}/g,'').length).reduce((a, b) => a + b, 0) - 14 - jackpotStr.length;\nprint(`{o}[{y}SLOTSv2{/} ${pad>0?' '.repeat(pad):''}{g}Jackpot{/} {y}${c}${jackpotStr}{/}{o}]               {dgr} *slot machine sounds*{/}`);\nprint('{o}(' + wheels.join('{y}-{/}') + '{o}){y}/{r}Â°');\n\nconst funds = store.get(IRC.message.from) || 100;\n\nif (_.uniq(wheels).length == 1) {\n    const newScore = +funds + +jackpot\n    store.set(IRC.message.from, newScore)\n    print(`{bl,gr}{rb} J A C K P O T !!!{/} ${IRC.message.from} has {y}${c}${Intl.NumberFormat().format(newScore)}`);\n    store.set('$megapot', defaultJackpot);\n}\nelse if (\n    (wheels[0]==wheels[1]&&wheels[0]==wheels[2])\n    || (wheels[1] == wheels[2]&&wheels[1]==wheels[3])\n) {\n    const win = (((Math.random()*10)|0)+1)*100;\n    const newScore = +funds + win;\n    store.set(IRC.message.from, newScore);\n    print(`${IRC.message.from} won {y}${c}${win}{/}! and has {y}${c}${Intl.NumberFormat().format(newScore)}{/}`);\n}\nelse if (wheels[0]==wheels[1]||wheels[1]==wheels[2]||wheels[2]==wheels[3]) {\n    const win = (((Math.random()*5)|0)+1)*5;\n    const newScore = +funds + win;\n    store.set(IRC.message.from, newScore);\n    print(`${IRC.message.from} won {y}${c}${win}{/}! and has {y}${c}${Intl.NumberFormat().format(newScore)}{/}`);\n}\nelse {\n    const newScore = +funds - cost\n    store.set(IRC.message.from, newScore);\n    print(`${IRC.message.from} has {y}${c}${Intl.NumberFormat().format(newScore)}{/}`)\n    store.set('$megapot', +jackpot + (cost * 2));\n}\n",
    "locked": false,
    "starred": false
}
